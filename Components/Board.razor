@rendermode InteractiveServer

<div class="board">
    @for (int row = 0; row < GameState.Rows; row++)
    {
        <div class="board-row">
            @for (int col = 0; col < GameState.Columns; col++)
            {
                var piece = CurrentGameState.GetPiece(row, col);
                var isWinningPiece = CurrentGameState.WinningPlay.Contains(row, col);
                
                <div class="board-cell" @onclick="() => PlayPiece(col)">
                    <div class="@GetPieceClass(piece, isWinningPiece)"></div>
                </div>
            }
        </div>
    }
</div>

@code {
    [Parameter]
    public required GameState CurrentGameState { get; set; }
    
    [Parameter]
    public EventCallback<int> OnPiecePlayed { get; set; }
    
    private async Task PlayPiece(int column)
    {
        await OnPiecePlayed.InvokeAsync(column);
    }
    
    private string GetPieceClass(GamePiece piece, bool isWinning)
    {
        var baseClass = "piece";
        
        if (piece == GamePiece.Empty)
            return baseClass;
        
        var colorClass = piece == GamePiece.Red ? "piece-red" : "piece-yellow";
        var winClass = isWinning ? "piece-winning" : "";
        
        return $"{baseClass} {colorClass} {winClass}".Trim();
    }
}
